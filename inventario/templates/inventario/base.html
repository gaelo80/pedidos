<!doctype html>
{% load static %}
{% load humanize %}
{% load inventario_extras %}
<html lang="es"> {# Establece el idioma a español #}
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {# El título puede ser sobrescrito por las plantillas hijas #}
    <title>{% block page_title %}LOUIS FERRY Premiere{% endblock page_title %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    {# Estilos CSS adicionales o personalizados #}
    <style>
        body {
            padding-top: 56px; /* Ajuste para la altura de la navbar fija */
            padding-bottom: 20px;
         }
        .messages { /* Contenedor para mensajes de Django */
            list-style: none;
            padding-left: 0;
            margin-top: 1rem;
            margin-bottom: 1rem;
         }
        /* Puedes añadir más estilos aquí o en un archivo CSS separado */
    </style>

    {# Bloque para añadir CSS extra desde plantillas hijas #}
    {% block extra_head %}{% endblock extra_head %}
  </head>
  <body>

    {# Barra de Navegación Fija Superior (Navbar) de Bootstrap #}
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
      <div class="container-fluid">
        {# Nombre de tu aplicación o logo #}
        <a class="navbar-brand" href="#">LOUIS FERRY Premiere</a>
        {# Botón para menú en móviles #}
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        {# Contenido del menú #}


          {# Contenido del menú #}
          <div class="collapse navbar-collapse" id="navbarCollapse">

            {% load inventario_extras %}
            {# Enlaces principales a la izquierda #}
            <ul class="navbar-nav me-auto mb-2 mb-md-0">

                {# --- Pedidos Bodega --- #}
                {# Visible SOLO para 'Personal de Bodega' o Superusuarios #}
                {% if user.is_authenticated %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'inventario_api:index' %}">
                    INICIO
                  </a>
                </li>
              {% endif %}


                {% if user.is_authenticated %}
                  {% if user|has_group:"Personal de Bodega" or user.is_superuser or user|has_group:"Administrativo" %}
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'lista_pedidos_bodega' %}">Pedidos Bodega</a>
                    </li>
                    {% endif %}
                    {% endif %}


                {% if user.is_authenticated %}
                  {% if user|has_group:"Personal de Bodega" or user.is_superuser or user|has_group:"Administrativo" %}
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'inventario_api:vista_conteo_inventario' %}">Conteo Inventario</a>
                  </li>
                  {% endif %}
                  {% endif %}
                
                {% if user.is_authenticated %}
                  {% if not user|has_group:"Personal de Bodega" or user|has_group:"Administrativo" %}
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'crear_pedido_web' %}">Crear Pedido Web</a>
                    </li>
                  {% endif %}
                {% endif %}

                {# --- Mis Borradores --- #}
                {# Visible para todos EXCEPTO 'Personal de Bodega' #}
                {% if user.is_authenticated %}
                  {% if not user|has_group:"Personal de Bodega" or user|has_group:"Administrativo" %}
                    <li class="nav-item">
                      <a class="nav-link" href="{% url 'lista_pedidos_borrador' %}">Mis Borradores</a> {# URL Corregida #}
                    </li>
                  {% endif %}
                {% endif %}

                {# --- Registrar Devolución --- #}
                {% if user.is_authenticated %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'crear_devolucion' %}">
                      Registrar Devolución
                    </a>
                  </li>
                {% endif %}


                {% if user.is_authenticated %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'inventario_api:reporte_cartera_general' %}">
                    Cartera
                  </a>
                </li>
              {% endif %}


                {# --- Registrar Ingreso --- #}
                {% if user.is_authenticated %}
                  {% if user.is_staff or user|has_group:"Administrativo" %} {# Asumiendo que AdminApp también puede #}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'registrar_ingreso' %}">
                      Registrar Ingreso
                    </a>
                  </li>
                {% endif %}
                  {% endif %}

               
                {# Visible si NO es Bodega Y (es Staff/Superuser/Vendedor) #}
                {% if user.is_authenticated %}
                {% if user|has_group:"Administrativo" %}
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'inventario:reporte_ventas_vendedor' %}">Informe Vendedores</a>
                    </li>

                {% elif not user|has_group:"Personal de Bodega" %}
                    {# Opción 2: Si NO es Admin App Y TAMPOCO es Bodega... #}
                    {% if user.is_staff or user.is_superuser or user|has_group:"Vendedores" %}
                        {# ... Y ADEMÁS es Staff/Superuser/Vendedor -> Mostrar #}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'reporte_ventas_vendedor' %}">Informe Vendedores</a>
                        </li>
                    {% endif %}
                {% endif %}
            {% endif %}

            {% if request.user.is_staff or request.user.is_superuser %} {# <-- AJUSTA ESTE PERMISO SEGÚN NECESITES #}
              <li class="nav-item">
                  {# Usa el namespace 'inventario_api' y el nombre 'importar_cartera' que definimos #}
                  <a class="nav-link {% if request.resolver_match.url_name == 'importar_cartera' %}active{% endif %}" 
                    href="{% url 'inventario_api:importar_cartera' %}">
                      <i class="fas fa-file-excel me-1"></i> {# Icono opcional #}
                      Importar Cartera
                  </a>
              </li>
              {% endif %}
              
              {% if es_vendedor or es_admin_app or request.user.is_superuser %}
              <li class="nav-item"> {# O la estructura de tu tarjeta en index.html #}
                  <a class="nav-link {% if request.resolver_match.url_name == 'reporte_cartera_general' %}active{% endif %}" 
                     href="{% url 'inventario_api:reporte_cartera_general' %}">
                       <i class="fas fa-file-invoice-dollar me-1"></i> 
                       Reporte Cartera
                  </a>
              </li>
              {% endif %}

            </ul>



             {# Puedes añadir más enlaces aquí, por ejemplo, a la lista de productos, clientes, etc. #}
             {# <li class="nav-item"><a class="nav-link" href="#">Productos</a></li> #}
          </ul>
          {# Información de usuario y logout/login a la derecha #}
          <ul class="navbar-nav ms-auto mb-2 mb-md-0">
             {% if user.is_authenticated %}
                 <li class="nav-item">
                     <span class="navbar-text me-2">Hola, {{ user.username }}!</span>
                 </li>


                 <li class="nav-item">
                  {# Formulario para enviar POST a la URL de logout #}
                  <form method="post" action="{% url 'logout' %}" style="display: inline;">
                      {% csrf_token %}
                      {# Botón estilizado para que parezca un enlace de navbar #}
                      <button type="submit" class="nav-link btn btn-link"
                              style="border: none; background: none; padding: 0; vertical-align: baseline; color: rgba(255,255,255,.55); cursor: pointer;">
                          Salir
                      </button>
                      {# Puedes ajustar el 'color:' para que coincida exactamente con tus otros nav-link #}
                  </form>
                </li>


             {% else %}
                 <li class="nav-item">
                    {# Enlace al login del admin. request.path asegura que vuelva a la página actual después de loguearse #}
                    <a class="nav-link" href="{% url 'login' %}?next={{ request.path }}">Entrar</a>
                 </li>
             {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    {# Contenedor principal donde irá el contenido específico de cada página #}
    <main class="container mt-4"> {# mt-4 añade margen superior #}

        {# Bloque para mostrar mensajes flash de Django (éxito, error, info) #}
        {% if messages %}
            {% for message in messages %}
                {# Asigna clases de alerta de Bootstrap según las etiquetas del mensaje #}
                <div class="alert alert-dismissible fade show {% if message.tags %}alert-{% if message.level == messages.ERROR %}danger{% else %}{{ message.tags }}{% endif %}{% else %}info{% endif %}" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
        {# Fin bloque de mensajes #}

        {# Bloque principal de contenido que será llenado por las plantillas hijas #}
        {% block content %}
            <p>Contenido por defecto si la plantilla hija no define el bloque 'content'.</p>
        {% endblock content %}

    </main> {# Fin contenedor principal #}


    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js" type="text/javascript"></script>


{# Bloque para añadir JS extra desde plantillas hijas #}
{% block extra_scripts %}{% endblock extra_scripts %}
</body>
</html>


